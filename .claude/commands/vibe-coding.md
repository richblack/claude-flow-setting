# Vibe Coding - 智能需求到實作工作流程

你現在是一個專業的需求分析和系統設計助手，將引導用戶通過 **5 個階段**，從自然語言需求逐步轉換為可執行的實作計畫。

## ⚠️ 重要：互動式工作流程

**這是一個互動式流程，每個階段都必須暫停等待用戶確認！**

- ✅ **每個階段完成後必須暫停**
- ✅ **等待用戶明確表示同意後才繼續**
- ✅ **如果用戶有疑問，修正後再次等待確認**
- ❌ **絕對不要自動進入下一階段**
- ❌ **不要一次性完成所有階段**

## 工作流程概述

1. **階段 1: 理解需求** - 收集和理解用戶的自然語言描述 → ⏸️ **暫停等待確認**
2. **階段 2: User Story Mapping** - 產生用戶故事映射 → ⏸️ **暫停等待確認**
3. **階段 3: EARS 驗收標準** - 為每個用戶故事新增驗收標準 → ⏸️ **暫停等待確認**
4. **階段 4: 系統設計** - 建立架構、元件、介面設計 → ⏸️ **暫停等待確認**
5. **階段 5: 任務分解** - 產生詳細的任務清單 → ⏸️ **暫停等待確認**

## 🔄 智能進度檢測

**每次執行 /vibe-coding 時，先檢查已完成的階段，自動從中斷處繼續！**

### 檢查順序（從後往前）：

1. **檢查 `rfp/tasks.md`**
   - ✅ 如果存在 → 所有階段已完成，詢問用戶：「Vibe Coding 工作流程已完成。您想要：1) 檢視現有文件 2) 修改某個階段 3) 重新開始？」

2. **檢查 `rfp/design.md`**
   - ✅ 如果存在但 tasks.md 不存在 → 從階段 5 開始
   - 告知用戶：「偵測到您已完成到階段 4（系統設計）。現在繼續階段 5: 任務分解。」

3. **檢查 `rfp/requirements.md`**
   - ✅ 如果存在但 design.md 不存在 → 從階段 4 開始
   - 告知用戶：「偵測到您已完成到階段 3（EARS 驗收標準）。現在繼續階段 4: 系統設計。」
   - 讀取 requirements.md 以了解需求

4. **檢查 `user-requirements/initial-requirements.md`**
   - ✅ 如果存在但 rfp/requirements.md 不存在 → 從階段 2 開始
   - 告知用戶：「偵測到您已完成階段 1（理解需求）。現在繼續階段 2: User Story Mapping。」
   - 讀取 initial-requirements.md 以了解需求

5. **都不存在**
   - 從階段 1 開始
   - 詢問用戶的需求

## 階段 1: 理解需求

**📍 僅在智能進度檢測判定從此階段開始時執行**

**任務：**
1. 詢問用戶：「請描述您想要實作的功能或系統。您可以用自然語言描述，越詳細越好。」
2. 如果用戶提供了需求，仔細閱讀並理解
3. 將用戶的需求總結為幾個關鍵點
4. 詢問用戶：「我理解的需求如下：[總結]。是否正確？還有需要補充的嗎？」
5. 將原始需求儲存到 `user-requirements/initial-requirements.md`

**⏸️ 階段 1 結束 - 必須在此停止！**

等待用戶明確回應：
- ✅ 如果用戶說「正確」、「繼續」、「下一步」→ 進入階段 2
- ⚠️ 如果用戶提出修正或疑問 → 修正後再次詢問確認
- ❌ **不要自動進入階段 2**

## 階段 2: User Story Mapping

**📍 僅在以下情況執行此階段：**
- 智能進度檢測判定從此階段開始（已有 initial-requirements.md）
- 或用戶在階段 1 確認後進入此階段

**⚠️ 如果從此階段開始，先讀取 `user-requirements/initial-requirements.md` 了解需求**

**任務：**
1. 基於理解的需求，產生 User Story Mapping
2. 每個 User Story 使用**一行格式**（重要！不要分成多行）：
   ```
   **使用者故事：** 作為 [角色]，我希望 [功能]，以便 [目的/價值]
   ```
3. 按照邏輯順序組織用戶故事
4. 以清單形式展示給用戶（不要使用表格）
5. 詢問用戶：「這些用戶故事是否完整反映了您的需求？需要調整或補充嗎？」

**⏸️ 階段 2 結束 - 必須在此停止！**

等待用戶明確回應：
- ✅ 如果用戶確認無誤 → 進入階段 3
- ⚠️ 如果用戶要求調整 → 修正後再次展示並等待確認
- ❌ **不要自動進入階段 3**

## 階段 3: EARS 驗收標準

**📍 僅在以下情況執行此階段：**
- 智能進度檢測判定從此階段開始（尚未檢測到，因為階段 2 和 3 都寫入同一檔案）
- 或用戶在階段 2 確認後進入此階段

**任務：**
1. 為每個用戶故事新增 EARS (Easy Approach to Requirements Syntax) 驗收標準
2. EARS 格式範例：
   ```
   #### 驗收標準
   1. 當 [觸發條件] 時，系統應 [系統行為]
   2. 當 [觸發條件] 時，系統應 [系統行為]
   3. 如果 [條件]，系統應 [系統行為]
   ```
3. 確保每個驗收標準：
   - 清晰、可測試
   - 使用「當...時」、「如果...則」等結構
   - 描述系統行為，而非實作細節
4. 展示完整的 User Stories + EARS 給用戶
5. 詢問用戶：「這些驗收標準是否準確描述了系統行為？需要調整嗎？」
6. 產生 `rfp/requirements.md`

**⏸️ 階段 3 結束 - 必須在此停止！**

等待用戶明確回應：
- ✅ 如果用戶確認無誤 → 進入階段 4
- ⚠️ 如果用戶要求調整 → 修正 requirements.md 後再次展示並等待確認
- ❌ **不要自動進入階段 4**

## 階段 4: 系統設計

**📍 僅在以下情況執行此階段：**
- 智能進度檢測判定從此階段開始（已有 requirements.md 但無 design.md）
- 或用戶在階段 3 確認後進入此階段

**⚠️ 如果從此階段開始，先讀取 `rfp/requirements.md` 了解需求和驗收標準**

**任務：**
1. 基於需求，設計系統架構和元件
2. 設計文件應包含：
   - **概述**：系統的整體描述
   - **架構**：系統架構圖（使用 Mermaid）和說明
   - **元件和介面**：主要元件、類別、介面定義（使用 TypeScript/虛擬碼）
   - **資料模型**：資料結構和關係
   - **錯誤處理**：錯誤處理策略
   - **測試策略**：測試方法和工具
   - **效能考量**：效能最佳化措施
   - **安全性**：安全考量
   - **部署和發布**：部署流程
3. 展示設計文件給用戶
4. 詢問用戶：「這個系統設計是否符合您的期望？有需要調整的地方嗎？」
5. 產生 `rfp/design.md`

**⏸️ 階段 4 結束 - 必須在此停止！**

等待用戶明確回應：
- ✅ 如果用戶確認設計無誤 → 進入階段 5
- ⚠️ 如果用戶要求調整設計 → 修正 design.md 後再次展示並等待確認
- ❌ **不要自動進入階段 5**

## 階段 5: 任務分解

**📍 僅在以下情況執行此階段：**
- 智能進度檢測判定從此階段開始（已有 design.md 但無 tasks.md）
- 或用戶在階段 4 確認後進入此階段

**⚠️ 如果從此階段開始，先讀取以下檔案了解完整脈絡：**
- `user-requirements/initial-requirements.md` - 原始需求
- `rfp/requirements.md` - User Stories 和驗收標準
- `rfp/design.md` - 系統設計

**任務：**
1. 基於系統設計，將實作工作分解為詳細的任務清單
2. 任務清單格式：
   ```markdown
   - [ ] 1. 主要任務標題
     - 任務描述
     - 具體工作內容（3-5 個要點）
     - _需求: X.X, X.X_

     - [ ] 1.1 子任務標題
       - 子任務描述
       - 具體工作內容
       - _需求: X.X, X.X_
   ```
3. 任務應該：
   - 按照邏輯實作順序排列
   - 包含清晰的任務描述和驗收標準
   - 引用相關的需求編號
   - 包含測試和文件任務
4. 展示完整的任務清單給用戶
5. 詢問用戶：「這個任務分解是否合理？是否需要調整優先順序或新增任務？」
6. 產生 `rfp/tasks.md`

**⏸️ 階段 5 結束 - 必須在此停止！**

等待用戶明確回應：
- ✅ 如果用戶確認任務分解合理 → 進入「完成工作流程」
- ⚠️ 如果用戶要求調整任務 → 修正 tasks.md 後再次展示並等待確認
- ❌ **不要自動進入完成階段**

## 完成工作流程

當所有 5 個階段完成後：

1. 總結產生的文件：
   - `user-requirements/initial-requirements.md` - 原始需求（用戶編寫）
   - `rfp/requirements.md` - User Stories + EARS 驗收標準（AI 產生）
   - `rfp/design.md` - 系統設計文件（AI 產生）
   - `rfp/tasks.md` - 任務分解清單（AI 產生）

2. 告知用戶：「Vibe Coding 工作流程已完成！所有文件已產生在 `rfp/` 目錄中。您現在可以：
   - 查看這些文件，確保理解完整
   - 使用 Claude Flow 開始實作：`claude-flow sparc run coder`
   - 或者讓我幫您開始實作第一個任務」

3. 使用 Claude Flow 記憶系統儲存進度：
   ```bash
   claude-flow memory store "vibe-coding-progress" "已完成需求分析和系統設計，產生了 requirements.md, design.md, tasks.md"
   ```

## ❗ 最重要的規則

**Claude 必須遵守的鐵律：**

1. **一次只執行一個階段** - 絕對不要一次完成多個階段
2. **每個階段結束後必須停止** - 看到「⏸️ 階段 X 結束」就立即停止
3. **等待用戶明確指示** - 只有當用戶說「繼續」、「下一步」、「確認」等明確指示才進入下一階段
4. **如果用戶有疑問** - 修正內容後再次詢問確認，不要自動繼續
5. **不要假設用戶同意** - 沉默不代表同意，必須等待明確回應

## 重要提示

- **逐階段進行**：每個階段完成後必須等待用戶確認再進入下一階段
- **保持互動**：鼓勵用戶提供回饋和調整
- **使用範例**：如果用戶需要，提供範例文件格式
- **儲存進度**：每個階段完成後儲存相應文件
- **彈性調整**：如果用戶想跳過某個階段或修改某個階段的輸出，彈性回應

## 開始工作流程

**執行智能進度檢測，找出應該從哪個階段開始**

1. 按照「🔄 智能進度檢測」的順序檢查檔案
2. 告知用戶目前的進度狀態
3. 從適當的階段開始（可能是 1-5 任一階段）
4. **記住：完成當前階段後必須停止並等待用戶確認！**

### 範例情境

**情境 1：全新專案**
- 沒有任何檔案 → 從階段 1 開始

**情境 2：中斷後恢復**
- 已有 initial-requirements.md 和 requirements.md → 從階段 4 開始
- 告知：「偵測到您已完成到階段 3，現在繼續階段 4: 系統設計」

**情境 3：已完成所有階段**
- 所有檔案都存在 → 詢問用戶想做什麼
- 選項：檢視、修改特定階段、重新開始

## 重要提醒

- **輸入目錄**: `user-requirements/` - 這裡存放用戶編寫的需求和參考資料
- **輸出目錄**: `rfp/` - 這裡存放 AI 自動產生的規格文件
- **不要混淆**：絕對不要將 AI 產生的內容寫入 `user-requirements/`
- **互動式流程**：每個階段都必須等待用戶明確確認後才繼續
